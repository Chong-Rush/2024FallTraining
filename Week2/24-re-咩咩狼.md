# 汇编语言笔记

作者：咩咩狼

## 寄存器

### 通用寄存器

- **AX**：累加寄存器，常用于算术和数据传输操作。
- **BX**：基址寄存器，可用于存储内存地址。
- **CX**：计数寄存器，常用于循环和串操作的计数。
- **DX**：数据寄存器，常用于I/O操作和乘除法运算。

### 段寄存器

- **CS（代码段寄存器）**：指向当前执行代码的段地址。
- **DS（数据段寄存器）**：指向数据段的起始地址。
- **SS（堆栈段寄存器）**：指向堆栈段的起始地址。

### 指针和变址寄存器

- **SP（堆栈指针）**：指向当前堆栈顶。

## 内存寻址方式

- **立即寻址**：操作数是一个立即数，例如：`MOV AX, 5`
- **寄存器寻址**：操作数是一个寄存器，例如：`MOV AX, BX`
- **直接寻址**：操作数是一个内存地址，例如：`MOV AX, [1234h]`
- **寄存器间接寻址**：通过寄存器间接访问内存，例如：`MOV AX, [BX]`
- **基址变址寻址**：使用基址和变址寄存器组合，例如：`MOV AX, [BP+SI]`
- **相对基址寻址**：基于段寄存器和偏移地址，例如：`MOV AX, [CS:IP+2]`

## 指令详解

### CALL 指令

**功能**：调用子程序。

**格式**：

- **近调用**：`CALL NEAR PTR ProcedureAddress`
- **远调用**：`CALL FAR PTR ProcedureAddress`

**操作**：

1. 将当前指令的下一条指令地址压入堆栈（保存返回地址）。
2. 修改IP（和CS）寄存器，跳转到子程序的入口地址。

**示例**：

```assembly
CALL SUB_ROUTINE
```

### RET 指令

**功能**：从子程序返回。

**格式**：

- **近返回**：`RET`
- **远返回**：`RETF`

**操作**：

1. 从堆栈弹出返回地址（IP），恢复到IP寄存器。
2. 对于远返回，还需要弹出CS寄存器的值。

**示例**：

```assembly
RET
```

### 逆向工程中常用指令

- **PUSH/POP**：压入和弹出堆栈，用于保存和恢复寄存器的值。
  - **示例**：
    ```assembly
    PUSH AX
    POP BX
    ```
- **JMP**：无条件跳转，用于改变程序的执行流程。
  - **示例**：
    ```assembly
    JMP LABEL1
    ```
- **JZ/JNZ（JE/JNE）**：条件跳转指令，根据标志位决定是否跳转。
  - **示例**：
    ```assembly
    CMP AX, 0
    JZ ZERO_LABEL
    ```
- **CMP**：比较指令，影响标志寄存器的值。
  - **示例**：
    ```assembly
    CMP AX, BX
    JNE NOT_EQUAL
    ```
- **MOV**：数据传输指令，用于在寄存器和内存之间移动数据。
  - **示例**：
    ```assembly
    MOV AX, [1234h]
    MOV BX, AX
    ```

## 标志寄存器（FLAGS）

标志寄存器用于反映运算的结果和CPU的状态。

- **ZF（零标志）**：结果为零时置位。
- **CF（进位标志）**：最高位有进位或借位时置位。
- **SF（符号标志）**：结果为负时置位。
- **OF（溢出标志）**：有符号运算溢出时置位。
- **PF（奇偶标志）**：结果的低8位中1的个数为偶数时置位。
- **AF（辅助进位标志）**：用于BCD运算。
